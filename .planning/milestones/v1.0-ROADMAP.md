# Milestone v1.0: MVP

**Status:** ✅ SHIPPED 2026-02-18
**Phases:** 1–4
**Total Plans:** 5

## Overview

Full working Chrome extension that zooms web pages based on webcam-detected head distance. Built from scratch in 3 days across 4 phases: camera infrastructure, MediaPipe inference, zoom control, and popup UI with persistence.

## Phases

### Phase 1: Foundation

**Goal:** The extension can open and close the webcam on demand without crashing the service worker
**Depends on:** Nothing (first phase)
**Plans:** 1 plan

Plans:
- [x] 01-01: Webcam lifecycle — offscreen document, SW keepalive, popup toggle + indicator

**Details:**
Offscreen document captures webcam via getUserMedia. Background service worker manages offscreen doc creation/teardown. Port-based keepalive (20s heartbeat) prevents service worker termination. Session-only state via chrome.storage.session. Permission helper page handles first-time camera access grant (offscreen docs can't show permission prompts directly).

---

### Phase 2: Detection Pipeline

**Goal:** The offscreen document detects face distance and reports readings to the background service worker
**Depends on:** Phase 1
**Plans:** 2 plans

Plans:
- [x] 02-01: Bundle MediaPipe WASM/model assets + manifest CSP config
- [x] 02-02: Wire FaceLandmarker detection loop + distance readings to background

**Details:**
MediaPipe Tasks Vision 0.10.32 bundled locally (CDN blocked by extension CSP). SIMD + noSIMD WASM variants included. Face landmark 33/263 (inter-eye) spread used as distance proxy. Detection runs at 1s intervals via setInterval. First 5 readings averaged to establish baseline; subsequent readings reported as ratio to background.

---

### Phase 3: Zoom Control

**Goal:** Page zoom on real browser tabs responds to head distance with stable, jitter-free behavior
**Depends on:** Phase 2
**Plans:** 1 plan

Plans:
- [x] 03-01: Distance-to-zoom mapping with EMA smoothing

**Details:**
Active tab tracked via chrome.tabs.onActivated. EMA smoothing applied to ratio readings. Dead zone (±20%) suppresses noise from minor head movement. Linear mapping outside dead zone: farther → zoom in (up to 2.5×), closer → zoom out (down to 0.3×). Snap-to-raw applied on changes > 15% to avoid stepped zoom on large movements. chrome.tabs.setZoom() used for native browser zoom.

---

### Phase 4: UI + Persistence

**Goal:** Users can configure zoom range and exclude sites, with all settings surviving browser restarts
**Depends on:** Phase 3
**Plans:** 1 plan

Plans:
- [x] 04-01: Max-zoom slider and per-site exclusion with chrome.storage.sync persistence

**Details:**
background.js seeds in-memory settings cache from chrome.storage.sync on startup, kept fresh by onChanged listener (avoids async reads on every DISTANCE_READING). Popup gains max-zoom slider (1.2–3.0), per-site exclude/unexclude button, and excluded sites list with Remove buttons. Slider saves on "change" (mouse release) not "input" (drag). Exclude button re-reads storage on click to avoid stale closures. Exclude button disabled on non-http tabs.

---

## Milestone Summary

**Key Decisions:**
- Offscreen document for getUserMedia (MV3 service workers cannot call getUserMedia)
- Long-lived port (not sendMessage) for offscreen-to-background channel — required for keepalive
- MediaPipe Tasks Vision bundled locally — CDN URLs blocked by extension CSP
- Inter-eye landmark spread as distance proxy — robust, simple, no 3D reconstruction needed
- EMA + dead zone for smoothing — implemented in Phase 3, not deferred (required for usability)
- In-memory settings cache in background — avoids async storage reads on hot path
- Closer = zoom out, farther = zoom in — user leaning in wants more content, not magnification

**Issues Resolved:**
- Offscreen docs can't show getUserMedia permission prompts → added permissions.html helper tab opened on NotAllowedError
- MV3 CSP blocks inline scripts → all JS in separate files
- Stepped zoom on large head movements → snap-to-raw when ratio change > 15%

**Issues Deferred:**
- None

**Technical Debt:**
- REQUIREMENTS.md traceability table never updated during execution (all requirements delivered but checkboxes remain unchecked)

---

*For current project status, see .planning/ROADMAP.md*
